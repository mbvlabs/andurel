package views

import (
	"fmt"
	"net/http"
	"strings"
	"testapp/models"
	"testapp/views/components"
)

templ DocumentIndex(documents []models.Document) {
	@base() {
		<main class="flex-1 px-6 py-10">
			<div class="mx-auto flex w-full max-w-5xl flex-col gap-6">
				<div class="flex flex-wrap items-center justify-between gap-4">
					<h1 class="text-2xl font-semibold tracking-tight text-base-content">Documents</h1>
					@components.Button(components.ButtonProps{Label: "New Document"}).WithHref("/").Render()
				</div>
				if len(documents) == 0 {
					<p class="text-sm text-base-content/60">No documents found.</p>
				} else {
					@components.Table() {
						@components.TableHeader() {
							@components.TableRow() {
								@components.TableHead() {
									Title 
								}
								@components.TableHead() {
									Tags 
								}
								@components.TableHead() {
									Page Numbers 
								}
								@components.TableHead() {
									View Count 
								}
								@components.TableHead() {
									Is Published 
								}
								@components.TableHead() {
									Created At 
								}
								@components.TableHead() {
									Updated At 
								}
								@components.TableHead() {
									Actions 
								}
							}
						}
						@components.TableBody() {
							for _, document := range documents {
								@components.TableRow() {
									@components.TableCell() {
										{ document.Title }
									}
									@components.TableCell() {
										{ strings.Join(document.Tags, ", ") }
									}
									@components.TableCell() {
										{ fmt.Sprintf("%v", document.PageNumbers) }
									}
									@components.TableCell() {
										{ fmt.Sprintf("%d", document.ViewCount) }
									}
									@components.TableCell() {
										{ fmt.Sprintf("%t", document.IsPublished) }
									}
									@components.TableCell() {
										{ document.CreatedAt.String() }
									}
									@components.TableCell() {
										{ document.UpdatedAt.String() }
									}
									@components.TableCell() {
										<div class="flex flex-wrap gap-3 text-sm">
											<a class="text-base-content/80 hover:text-base-content" href="/">View</a>
											<a class="text-base-content/80 hover:text-base-content" href="/">Edit</a>
										</div>
									}
								}
							}
						}
					}
				}
			</div>
		</main>
	}
}

templ DocumentShow(document models.Document) {
	@base() {
		<main class="flex-1 px-6 py-10">
			<div class="mx-auto flex w-full max-w-4xl flex-col gap-6">
				<div class="flex flex-wrap items-center justify-between gap-4">
					<h1 class="text-2xl font-semibold tracking-tight text-base-content">Document Details</h1>
					<div class="flex flex-wrap gap-3">
						@components.Button(components.ButtonProps{Label: "Edit"}).WithHref("/").Render()
						<a class="text-sm text-base-content/70 hover:text-base-content" href="/">Back to List</a>
					</div>
				</div>
				@components.Card() {
					@components.CardContent() {
						<div class="grid gap-5 sm:grid-cols-2">
							<div class="space-y-1">
								@components.Label(components.LabelProps{Text: "Title"}).Render()
								<p class="text-sm text-base-content">{ document.Title }</p>
							</div>
							<div class="space-y-1">
								@components.Label(components.LabelProps{Text: "Tags"}).Render()
								<p class="text-sm text-base-content">{ strings.Join(document.Tags, ", ") }</p>
							</div>
							<div class="space-y-1">
								@components.Label(components.LabelProps{Text: "Page Numbers"}).Render()
								<p class="text-sm text-base-content">{ fmt.Sprintf("%v", document.PageNumbers) }</p>
							</div>
							<div class="space-y-1">
								@components.Label(components.LabelProps{Text: "View Count"}).Render()
								<p class="text-sm text-base-content">{ fmt.Sprintf("%d", document.ViewCount) }</p>
							</div>
							<div class="space-y-1">
								@components.Label(components.LabelProps{Text: "Is Published"}).Render()
								<p class="text-sm text-base-content">{ fmt.Sprintf("%t", document.IsPublished) }</p>
							</div>
							<div class="space-y-1">
								@components.Label(components.LabelProps{Text: "Created At"}).Render()
								<p class="text-sm text-base-content">{ document.CreatedAt.String() }</p>
							</div>
							<div class="space-y-1">
								@components.Label(components.LabelProps{Text: "Updated At"}).Render()
								<p class="text-sm text-base-content">{ document.UpdatedAt.String() }</p>
							</div>
						</div>
					}
				}
			</div>
		</main>
	}
}

templ DocumentNew() {
	@base() {
		<main class="flex-1 flex items-center justify-center px-6 py-10">
			<div class="mx-auto flex w-full max-w-md flex-col gap-6">
				@components.Card() {
					@components.CardHeader() {
						@components.CardTitle("New Document")
						@components.CardDescription("Enter the details for the new document.")
					}
					@components.CardContent() {
						@components.Form(components.FormProps{Action: http.MethodPost, URL: "/"}, components.WithClass("space-y-5"), components.WithFragment("new-document-form")) {
							<div class="space-y-4">
								<div class="space-y-1">
									@components.Label(components.LabelProps{Text: "Title"}).WithFor("title").Render()
									@components.Input("title").Render()
								</div>
								<div class="space-y-1">
									@components.Label(components.LabelProps{Text: "Tags"}).WithFor("tags").Render()
									@components.Input("tags").Render()
								</div>
								<div class="space-y-1">
									@components.Label(components.LabelProps{Text: "Page Numbers"}).WithFor("pageNumbers").Render()
									@components.Input("pageNumbers").Render()
								</div>
								<div class="space-y-1">
									@components.Label(components.LabelProps{Text: "View Count"}).WithFor("viewCount").Render()
									@components.Input("viewCount").WithType(components.InputTypeNumber).Render()
								</div>
								<div class="flex items-center gap-2">
									@components.Checkbox("isPublished").Render()
									@components.Label(components.LabelProps{Text: "Is Published"}).WithFor("isPublished").Render()
								</div>
							</div>
							@components.Button(components.ButtonProps{Label: "Create Document"}).WithType(components.ButtonTypeSubmit).WithFullWidth(true).Render()
						}
					}
				}
			</div>
		</main>
	}
}

templ DocumentEdit(document models.Document) {
	@base() {
		<main class="flex-1 flex items-center justify-center px-6 py-10">
			<div class="mx-auto flex w-full max-w-md flex-col gap-6">
				@components.Card() {
					@components.CardHeader() {
						@components.CardTitle("Edit Document")
						@components.CardDescription("Update the details for this document.")
					}
					@components.CardContent() {
						@components.Form(components.FormProps{Action: http.MethodPut, URL: "/"}, components.WithClass("space-y-5"), components.WithFragment("edit-document-form")) {
							<div class="space-y-4">
								<div class="space-y-1">
									@components.Label(components.LabelProps{Text: "Title"}).WithFor("title").Render()
									@components.Input("title").WithValue(document.Title).Render()
								</div>
								<div class="space-y-1">
									@components.Label(components.LabelProps{Text: "Tags"}).WithFor("tags").Render()
									@components.Input("tags").WithValue(strings.Join(document.Tags, ", ")).Render()
								</div>
								<div class="space-y-1">
									@components.Label(components.LabelProps{Text: "Page Numbers"}).WithFor("pageNumbers").Render()
									@components.Input("pageNumbers").WithValue(fmt.Sprintf("%v", document.PageNumbers)).Render()
								</div>
								<div class="space-y-1">
									@components.Label(components.LabelProps{Text: "View Count"}).WithFor("viewCount").Render()
									@components.Input("viewCount").WithType(components.InputTypeNumber).WithValue(fmt.Sprintf("%d", document.ViewCount)).Render()
								</div>
								<div class="flex items-center gap-2">
									@components.Checkbox("isPublished").WithChecked(document.IsPublished).Render()
									@components.Label(components.LabelProps{Text: "Is Published"}).WithFor("isPublished").Render()
								</div>
							</div>
							@components.Button(components.ButtonProps{Label: "Update Document"}).WithType(components.ButtonTypeSubmit).WithFullWidth(true).Render()
						}
						@components.Separator().Render()
						@components.Button(components.ButtonProps{Label: "Destroy Document"}).MakeDestructive().WithFullWidth(true).WithAttr("data-on:click", fmt.Sprintf("@delete('%s')", "/")).Render()
					}
				}
			</div>
		</main>
	}
}
