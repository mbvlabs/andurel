package views

import (
	"fmt"
	"net/http"
	"testapp/internal/hypermedia"
	ui "testapp/internal/ui"
	"testapp/models"
	"testapp/router/routes"
)

templ OrderIndex(orders []models.Order) {
	@base() {
		<main class="flex-1 px-6 py-10">
			<div class="mx-auto flex w-full max-w-5xl flex-col gap-6">
				<div class="flex flex-wrap items-center justify-between gap-4">
					<h1 class="text-2xl font-semibold tracking-tight text-base-content">Orders</h1>
					@ui.Button(ui.ButtonProps{Label: "New Order"}).WithHref(routes.OrderNew.URL()).Render()
				</div>
				if len(orders) == 0 {
					<p class="text-sm text-base-content/60">No orders found.</p>
				} else {
					@ui.Table() {
						@ui.TableHeader() {
							@ui.TableRow() {
								@ui.TableHead() {
									Account Id 
								}
								@ui.TableHead() {
									Customer Name 
								}
								@ui.TableHead() {
									Total 
								}
								@ui.TableHead() {
									Signature 
								}
								@ui.TableHead() {
									Created At 
								}
								@ui.TableHead() {
									Updated At 
								}
								@ui.TableHead() {
									Actions 
								}
							}
						}
						@ui.TableBody() {
							for _, order := range orders {
								@ui.TableRow() {
									@ui.TableCell() {
										{ order.AccountID.String() }
									}
									@ui.TableCell() {
										{ order.CustomerName }
									}
									@ui.TableCell() {
										{ fmt.Sprintf("%f", order.Total) }
									}
									@ui.TableCell() {
										{ string(order.Signature) }
									}
									@ui.TableCell() {
										{ order.CreatedAt.String() }
									}
									@ui.TableCell() {
										{ order.UpdatedAt.String() }
									}
									@ui.TableCell() {
										<div class="flex flex-wrap gap-3 text-sm">
											<a class="text-base-content/80 hover:text-base-content" href={ routes.OrderShow.URL(order.ID) }>View</a>
											<a class="text-base-content/80 hover:text-base-content" href={ routes.OrderEdit.URL(order.ID) }>Edit</a>
										</div>
									}
								}
							}
						}
					}
				}
			</div>
		</main>
	}
}

templ OrderShow(order models.Order) {
	@base() {
		<main class="flex-1 px-6 py-10">
			<div class="mx-auto flex w-full max-w-4xl flex-col gap-6">
				<div class="flex flex-wrap items-center justify-between gap-4">
					<h1 class="text-2xl font-semibold tracking-tight text-base-content">Order Details</h1>
					<div class="flex flex-wrap gap-3">
						@ui.Button(ui.ButtonProps{Label: "Edit"}).WithHref(routes.OrderEdit.URL(order.ID)).Render()
						<a class="text-sm text-base-content/70 hover:text-base-content" href={ routes.OrderIndex.URL() }>Back to List</a>
					</div>
				</div>
				@ui.Card() {
					@ui.CardContent() {
						<div class="grid gap-5 sm:grid-cols-2">
							<div class="space-y-1">
								@ui.Label(ui.LabelProps{Text: "Account Id"}).Render()
								<p class="text-sm text-base-content">{ order.AccountID.String() }</p>
							</div>
							<div class="space-y-1">
								@ui.Label(ui.LabelProps{Text: "Customer Name"}).Render()
								<p class="text-sm text-base-content">{ order.CustomerName }</p>
							</div>
							<div class="space-y-1">
								@ui.Label(ui.LabelProps{Text: "Total"}).Render()
								<p class="text-sm text-base-content">{ fmt.Sprintf("%f", order.Total) }</p>
							</div>
							<div class="space-y-1">
								@ui.Label(ui.LabelProps{Text: "Signature"}).Render()
								<p class="text-sm text-base-content">{ string(order.Signature) }</p>
							</div>
							<div class="space-y-1">
								@ui.Label(ui.LabelProps{Text: "Created At"}).Render()
								<p class="text-sm text-base-content">{ order.CreatedAt.String() }</p>
							</div>
							<div class="space-y-1">
								@ui.Label(ui.LabelProps{Text: "Updated At"}).Render()
								<p class="text-sm text-base-content">{ order.UpdatedAt.String() }</p>
							</div>
						</div>
					}
				}
			</div>
		</main>
	}
}

templ OrderNew() {
	@base() {
		<main class="flex-1 flex items-center justify-center px-6 py-10">
			<div class="mx-auto flex w-full max-w-md flex-col gap-6">
				@ui.Card() {
					@ui.CardHeader() {
						@ui.CardTitle("New Order")
						@ui.CardDescription("Enter the details for the new order.")
					}
					@ui.CardContent() {
						@ui.Form(ui.FormProps{Action: http.MethodPost, URL: routes.OrderCreate.URL()}, ui.WithClass("space-y-5"), ui.WithFragment("new-order-form")) {
							<div class="space-y-4">
								<div class="space-y-1">
									@ui.Label(ui.LabelProps{Text: "Account Id"}).WithFor("accountId").Render()
									@ui.Input("accountId").Render()
								</div>
								<div class="space-y-1">
									@ui.Label(ui.LabelProps{Text: "Customer Name"}).WithFor("customerName").Render()
									@ui.Input("customerName").Render()
								</div>
								<div class="space-y-1">
									@ui.Label(ui.LabelProps{Text: "Total"}).WithFor("total").Render()
									@ui.Input("total").WithType(ui.InputTypeNumber).Render()
								</div>
								<div class="space-y-1">
									@ui.Label(ui.LabelProps{Text: "Signature"}).WithFor("signature").Render()
									@ui.Input("signature").Render()
								</div>
							</div>
							@ui.Button(ui.ButtonProps{Label: "Create Order"}).WithType(ui.ButtonTypeSubmit).WithFullWidth(true).Render()
						}
					}
				}
			</div>
		</main>
	}
}

templ OrderEdit(order models.Order) {
	@base() {
		<main class="flex-1 flex items-center justify-center px-6 py-10">
			<div class="mx-auto flex w-full max-w-md flex-col gap-6">
				@ui.Card() {
					@ui.CardHeader() {
						@ui.CardTitle("Edit Order")
						@ui.CardDescription("Update the details for this order.")
					}
					@ui.CardContent() {
						@ui.Form(ui.FormProps{Action: http.MethodPut, URL: routes.OrderUpdate.URL(order.ID)}, ui.WithClass("space-y-5"), ui.WithFragment("edit-order-form")) {
							<div class="space-y-4">
								<div class="space-y-1">
									@ui.Label(ui.LabelProps{Text: "Account Id"}).WithFor("accountId").Render()
									@ui.Input("accountId").WithValue(order.AccountID.String()).Render()
								</div>
								<div class="space-y-1">
									@ui.Label(ui.LabelProps{Text: "Customer Name"}).WithFor("customerName").Render()
									@ui.Input("customerName").WithValue(order.CustomerName).Render()
								</div>
								<div class="space-y-1">
									@ui.Label(ui.LabelProps{Text: "Total"}).WithFor("total").Render()
									@ui.Input("total").WithType(ui.InputTypeNumber).WithValue(fmt.Sprintf("%f", order.Total)).Render()
								</div>
								<div class="space-y-1">
									@ui.Label(ui.LabelProps{Text: "Signature"}).WithFor("signature").Render()
									@ui.Input("signature").WithValue(string(order.Signature)).Render()
								</div>
							</div>
							@ui.Button(ui.ButtonProps{Label: "Update Order"}).WithType(ui.ButtonTypeSubmit).WithFullWidth(true).Render()
						}
						@ui.Separator().Render()
						@ui.Button(ui.ButtonProps{Label: "Destroy Order"}).MakeDestructive().WithFullWidth(true).WithAttr("data-on:click", hypermedia.DataAction(http.MethodDelete, routes.OrderDestroy.URL(order.ID))).Render()
					}
				}
			</div>
		</main>
	}
}
