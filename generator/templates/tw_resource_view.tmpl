package views

import (
	"fmt"
	"net/http"
	"strings"
	"{{.ModulePath}}/models"
	"{{.ModulePath}}/router/routes"
	"{{.ModulePath}}/internal/hypermedia"
	"{{.ModulePath}}/views/components"
)

templ {{.ResourceName}}Index({{.PluralName}} []models.{{.ResourceName}}) {
	@base() {
		<main class="flex-1 px-6 py-10">
			<div class="mx-auto flex w-full max-w-5xl flex-col gap-6">
				<div class="flex flex-wrap items-center justify-between gap-4">
					<h1 class="text-2xl font-semibold tracking-tight text-base-content">{{Plural .ResourceName}}</h1>
					@components.Button(components.ButtonProps{Label: "New {{.ResourceName}}"}).WithHref(routes.{{.ResourceName}}New.URL()).Render()
				</div>
				if len({{.PluralName}}) == 0 {
					<p class="text-sm text-base-content/60">No {{.PluralName}} found.</p>
				} else {
					@components.Table() {
						@components.TableHeader() {
							@components.TableRow() {
								{{range .Fields}}@components.TableHead() { {{.DisplayName}} }
								{{end}}@components.TableHead() { Actions }
							}
						}
						@components.TableBody() {
							for _, {{.ResourceName | ToLower}} := range {{.PluralName}} {
								@components.TableRow() {
									{{range .Fields}}@components.TableCell() { {{StringTableDisplay . $.ResourceName}} }
									{{end}}@components.TableCell() {
										<div class="flex flex-wrap gap-3 text-sm">
											<a class="text-base-content/80 hover:text-base-content" href={ routes.{{$.ResourceName}}Show.URL({{$.ResourceName | ToLower}}.ID) }>View</a>
											<a class="text-base-content/80 hover:text-base-content" href={ routes.{{$.ResourceName}}Edit.URL({{$.ResourceName | ToLower}}.ID) }>Edit</a>
										</div>
									}
								}
							}
						}
					}
				}
			</div>
		</main>
	}
}

templ {{.ResourceName}}Show({{.ResourceName | ToLower}} models.{{.ResourceName}}) {
	@base() {
		<main class="flex-1 px-6 py-10">
			<div class="mx-auto flex w-full max-w-4xl flex-col gap-6">
				<div class="flex flex-wrap items-center justify-between gap-4">
					<h1 class="text-2xl font-semibold tracking-tight text-base-content">{{.ResourceName}} Details</h1>
					<div class="flex flex-wrap gap-3">
						@components.Button(components.ButtonProps{Label: "Edit"}).WithHref(routes.{{.ResourceName}}Edit.URL({{.ResourceName | ToLower}}.ID)).Render()
						<a class="text-sm text-base-content/70 hover:text-base-content" href={ routes.{{.ResourceName}}Index.URL() }>Back to List</a>
					</div>
				</div>
				@components.Card() {
					@components.CardContent() {
						<div class="grid gap-5 sm:grid-cols-2">
							{{range .Fields}}<div class="space-y-1">
								@components.Label(components.LabelProps{Text: "{{.DisplayName}}"}).Render()
								<p class="text-sm text-base-content">{{StringDisplay . $.ResourceName}}</p>
							</div>
							{{end}}
						</div>
					}
				}
			</div>
		</main>
	}
}

templ {{.ResourceName}}New() {
	@base() {
		<main class="flex-1 flex items-center justify-center px-6 py-10">
			<div class="mx-auto flex w-full max-w-md flex-col gap-6">
				@components.Card() {
					@components.CardHeader() {
						@components.CardTitle("New {{.ResourceName}}")
						@components.CardDescription("Enter the details for the new {{.ResourceName | ToLower}}.")
					}
					@components.CardContent() {
						@components.Form(components.FormProps{Action: http.MethodPost, URL: routes.{{.ResourceName}}Create.URL()}, components.WithClass("space-y-5"), components.WithFragment("new-{{.ResourceName | ToLower}}-form")) {
							<div class="space-y-4">
								{{range .Fields}}{{if not .IsSystemField}}{{if eq .InputType "checkbox"}}<div class="flex items-center gap-2">
									@components.Checkbox("{{.CamelCase}}").Render()
									@components.Label(components.LabelProps{Text: "{{.DisplayName}}"}).WithFor("{{.CamelCase}}").Render()
								</div>
								{{else if eq .InputType "date"}}<div class="space-y-1">
									@components.Label(components.LabelProps{Text: "{{.DisplayName}}"}).WithFor("{{.CamelCase}}").Render()
									@components.Datepicker("{{.CamelCase}}").Render()
								</div>
								{{else if eq .InputType "number"}}<div class="space-y-1">
									@components.Label(components.LabelProps{Text: "{{.DisplayName}}"}).WithFor("{{.CamelCase}}").Render()
									@components.Input("{{.CamelCase}}").WithType(components.InputTypeNumber).Render()
								</div>
								{{else}}<div class="space-y-1">
									@components.Label(components.LabelProps{Text: "{{.DisplayName}}"}).WithFor("{{.CamelCase}}").Render()
									@components.Input("{{.CamelCase}}").Render()
								</div>
								{{end}}{{end}}{{end}}
							</div>
							@components.Button(components.ButtonProps{Label: "Create {{.ResourceName}}"}).WithType(components.ButtonTypeSubmit).WithFullWidth(true).Render()
						}
					}
				}
			</div>
		</main>
	}
}

templ {{.ResourceName}}Edit({{.ResourceName | ToLower}} models.{{.ResourceName}}) {
	@base() {
		<main class="flex-1 flex items-center justify-center px-6 py-10">
			<div class="mx-auto flex w-full max-w-md flex-col gap-6">
				@components.Card() {
					@components.CardHeader() {
						@components.CardTitle("Edit {{.ResourceName}}")
						@components.CardDescription("Update the details for this {{.ResourceName | ToLower}}.")
					}
					@components.CardContent() {
						@components.Form(components.FormProps{Action: http.MethodPut, URL: routes.{{.ResourceName}}Update.URL({{.ResourceName | ToLower}}.ID)}, components.WithClass("space-y-5"), components.WithFragment("edit-{{.ResourceName | ToLower}}-form")) {
							<div class="space-y-4">
								{{range .Fields}}{{if not .IsSystemField}}{{if eq .InputType "checkbox"}}<div class="flex items-center gap-2">
									@components.Checkbox("{{.CamelCase}}").WithChecked({{FieldRef . $.ResourceName}}).Render()
									@components.Label(components.LabelProps{Text: "{{.DisplayName}}"}).WithFor("{{.CamelCase}}").Render()
								</div>
								{{else if eq .InputType "date"}}<div class="space-y-1">
									@components.Label(components.LabelProps{Text: "{{.DisplayName}}"}).WithFor("{{.CamelCase}}").Render()
									@components.Datepicker("{{.CamelCase}}").WithValue({{StringValue . $.ResourceName}}).Render()
								</div>
								{{else if eq .InputType "number"}}<div class="space-y-1">
									@components.Label(components.LabelProps{Text: "{{.DisplayName}}"}).WithFor("{{.CamelCase}}").Render()
									@components.Input("{{.CamelCase}}").WithType(components.InputTypeNumber).WithValue({{StringValue . $.ResourceName}}).Render()
								</div>
								{{else}}<div class="space-y-1">
									@components.Label(components.LabelProps{Text: "{{.DisplayName}}"}).WithFor("{{.CamelCase}}").Render()
									@components.Input("{{.CamelCase}}").WithValue({{StringValue . $.ResourceName}}).Render()
								</div>
								{{end}}{{end}}{{end}}
							</div>
							@components.Button(components.ButtonProps{Label: "Update {{.ResourceName}}"}).WithType(components.ButtonTypeSubmit).WithFullWidth(true).Render()
						}
						@components.Separator().Render()
						@components.Button(components.ButtonProps{Label: "Destroy {{.ResourceName}}"}).MakeDestructive().WithFullWidth(true).WithAttr("data-on:click", hypermedia.DataAction(http.MethodDelete, routes.{{.ResourceName}}Destroy.URL({{.ResourceName | ToLower}}.ID))).Render()
					}
				}
			</div>
		</main>
	}
}
