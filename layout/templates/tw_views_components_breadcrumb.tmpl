package components

// --- Builder ---

type BreadcrumbBuilder struct {
	id         string
	class      string
	attrs      templ.Attributes
	fragmentID string
}

// Breadcrumb renders a navigation trail showing the user's current location in a hierarchy.
// Use it at the top of a page to help users navigate back to parent sections.
// Compose with BreadcrumbItem, BreadcrumbLink, and BreadcrumbSeparator sub-components.
//
//	@components.Breadcrumb().Render() {
//		@components.BreadcrumbItem() {
//			@components.BreadcrumbLink("Home", "/", false)
//		}
//		@components.BreadcrumbSeparator()
//		@components.BreadcrumbItem() {
//			@components.BreadcrumbLink("Current Page", "", true)
//		}
//	}
func Breadcrumb() *BreadcrumbBuilder {
	return &BreadcrumbBuilder{}
}

func (b *BreadcrumbBuilder) WithID(id string) *BreadcrumbBuilder     { b.id = id; return b }
func (b *BreadcrumbBuilder) WithClass(c string) *BreadcrumbBuilder   { b.class = cn(b.class, c); return b }
func (b *BreadcrumbBuilder) SetClass(c string) *BreadcrumbBuilder    { b.class = c; return b }
func (b *BreadcrumbBuilder) WithAttr(key string, val any) *BreadcrumbBuilder {
	if b.attrs == nil { b.attrs = templ.Attributes{} }
	b.attrs[key] = val; return b
}
func (b *BreadcrumbBuilder) WithFragment(id string) *BreadcrumbBuilder { b.fragmentID = id; return b }

// --- Class helpers ---

func breadcrumbClasses(b *BreadcrumbBuilder) string {
	return cn("flex flex-wrap items-center gap-1.5 text-sm text-base-content/60", b.class)
}

func breadcrumbItemClasses(class string) string {
	return cn("inline-flex items-center gap-1.5", class)
}

func breadcrumbLinkClasses(active bool, class string) string {
	if active {
		return cn("font-medium text-base-content", class)
	}
	return cn("transition-colors hover:text-base-content", class)
}

func breadcrumbSeparatorClasses(class string) string {
	return cn("text-base-content/40", class)
}

// --- Templ ---

templ (b *BreadcrumbBuilder) Render() {
	if b.fragmentID != "" {
		@templ.Fragment(b.fragmentID) {
			@b.render()
		}
	} else {
		@b.render()
	}
}

templ (b *BreadcrumbBuilder) render() {
	<nav aria-label="breadcrumb">
		<ol
			class={ breadcrumbClasses(b) }
			if b.id != "" {
				id={ b.id }
			}
			if b.attrs != nil {
				{ b.attrs... }
			}
		>
			{ children... }
		</ol>
	</nav>
}

templ BreadcrumbItem(opts ...Opt) {
	<li class={ breadcrumbItemClasses(classFrom(opts)) } if attrsFrom(opts) != nil { { attrsFrom(opts)... } }>
		{ children... }
	</li>
}

templ BreadcrumbLink(label string, href string, active bool, opts ...Opt) {
	if active {
		<span class={ breadcrumbLinkClasses(active, classFrom(opts)) } aria-current="page" if attrsFrom(opts) != nil { { attrsFrom(opts)... } }>
			{ label }
		</span>
	} else {
		<a href={ templ.SafeURL(href) } class={ breadcrumbLinkClasses(active, classFrom(opts)) } if attrsFrom(opts) != nil { { attrsFrom(opts)... } }>
			{ label }
		</a>
	}
}

templ BreadcrumbSeparator(opts ...Opt) {
	<li role="presentation" class={ breadcrumbSeparatorClasses(classFrom(opts)) } if attrsFrom(opts) != nil { { attrsFrom(opts)... } }>
		<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"></path></svg>
	</li>
}
