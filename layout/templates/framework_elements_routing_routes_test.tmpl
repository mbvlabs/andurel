// Package routing provides implementations of different kinds of routes.
// Code generated and maintained by the andurel framework. DO NOT EDIT.
package routing

import "testing"

func TestSanitizePath(t *testing.T) {
	tests := []struct {
		name     string
		path     string
		expected string
	}{
		// Basic valid paths
		{name: "root slash", path: "/", expected: "/"},
		{name: "simple path", path: "/articles", expected: "/articles"},
		{name: "nested path", path: "/articles/new", expected: "/articles/new"},
		{name: "path with param", path: "/articles/:id", expected: "/articles/:id"},
		{name: "path with multiple params", path: "/articles/:id/user/:id", expected: "/articles/:id/user/:id"},

		// Trailing slash removal
		{name: "trailing slash simple", path: "/articles/", expected: "/articles"},
		{name: "trailing slash nested", path: "/articles/new/", expected: "/articles/new"},
		{name: "trailing slash with param", path: "/articles/:id/", expected: "/articles/:id"},
		{name: "root slash preserved", path: "/", expected: "/"},

		// Missing leading slash
		{name: "missing leading slash", path: "articles", expected: "/articles"},
		{name: "missing leading slash nested", path: "articles/new", expected: "/articles/new"},

		// Double slashes
		{name: "double slash middle", path: "/articles//new", expected: "/articles/new"},
		{name: "double slash start", path: "//articles", expected: "/articles"},
		{name: "multiple double slashes", path: "/articles///new//edit", expected: "/articles/new/edit"},

		// Whitespace
		{name: "leading whitespace", path: " /articles", expected: "/articles"},
		{name: "trailing whitespace", path: "/articles ", expected: "/articles"},
		{name: "both whitespace", path: " /articles ", expected: "/articles"},
		{name: "whitespace with trailing slash", path: " /articles/ ", expected: "/articles"},

		// Query strings
		{name: "query string", path: "/articles?page=1", expected: "/articles"},
		{name: "query string complex", path: "/articles?page=1&sort=desc", expected: "/articles"},
		{name: "query string with path", path: "/articles/new?draft=true", expected: "/articles/new"},

		// Fragments
		{name: "fragment", path: "/articles#section", expected: "/articles"},
		{name: "fragment with path", path: "/articles/new#top", expected: "/articles/new"},
		{name: "query and fragment", path: "/articles?page=1#section", expected: "/articles"},

		// Backslashes (Windows-style)
		{name: "backslash simple", path: "\\articles", expected: "/articles"},
		{name: "backslash nested", path: "\\articles\\new", expected: "/articles/new"},
		{name: "mixed slashes", path: "/articles\\new", expected: "/articles/new"},
		{name: "backslash with leading slash", path: "/articles\\new\\edit", expected: "/articles/new/edit"},

		// Combined issues
		{name: "whitespace and trailing slash", path: " /articles/ ", expected: "/articles"},
		{name: "backslash and query", path: "\\articles\\new?id=1", expected: "/articles/new"},
		{name: "all issues", path: " \\articles\\\\new/?page=1#top ", expected: "/articles/new"},
	}

	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			result := sanitizePath(tt.path, "test-route")
			if result != tt.expected {
				t.Errorf("sanitizePath(%q) = %q, want %q", tt.path, result, tt.expected)
			}
		})
	}
}

func TestBuildPath(t *testing.T) {
	tests := []struct {
		name     string
		path     string
		prefix   string
		expected string
	}{
		// No prefix
		{name: "no prefix empty path", path: "", prefix: "", expected: ""},
		{name: "no prefix with path", path: "/articles", prefix: "", expected: "/articles"},

		// With prefix
		{name: "prefix with empty path", path: "", prefix: "/api", expected: "/api"},
		{name: "prefix and path both with slash", path: "/articles", prefix: "/api/", expected: "/api/articles"},
		{name: "prefix with slash path without", path: "articles", prefix: "/api/", expected: "/api/articles"},
		{name: "prefix without slash path with", path: "/articles", prefix: "/api", expected: "/api/articles"},
		{name: "neither with slash", path: "articles", prefix: "/api", expected: "/api/articles"},
	}

	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			result := buildPath(tt.path, tt.prefix, "test-route")
			if result != tt.expected {
				t.Errorf("buildPath(%q, %q) = %q, want %q", tt.path, tt.prefix, result, tt.expected)
			}
		})
	}
}

func TestConfigurePath(t *testing.T) {
	tests := []struct {
		name     string
		path     string
		prefix   string
		expected string
	}{
		// Root paths
		{name: "empty path no prefix", path: "", prefix: "", expected: "/"},
		{name: "slash path no prefix", path: "/", prefix: "", expected: "/"},

		// Simple paths
		{name: "simple path no prefix", path: "/articles", prefix: "", expected: "/articles"},
		{name: "simple path with prefix", path: "/items", prefix: "/api", expected: "/api/items"},

		// Index routes with prefix
		{name: "empty path with prefix", path: "", prefix: "/api", expected: "/api"},
		{name: "empty path with prefix trailing slash", path: "", prefix: "/api/", expected: "/api"},

		// Paths with params
		{name: "param path", path: "/:id", prefix: "/articles", expected: "/articles/:id"},
		{name: "multiple params", path: "/:id/comments/:commentId", prefix: "/articles", expected: "/articles/:id/comments/:commentId"},

		// Edge cases that should be sanitized
		{name: "trailing slash removed", path: "/articles/", prefix: "", expected: "/articles"},
		{name: "prefix trailing slash with path", path: "/items/", prefix: "/api/", expected: "/api/items"},
	}

	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			result := configurePath(tt.path, tt.prefix, "test-route")
			if result != tt.expected {
				t.Errorf("configurePath(%q, %q) = %q, want %q", tt.path, tt.prefix, result, tt.expected)
			}
		})
	}
}
