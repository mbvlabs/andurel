package components

// --- Builder ---

type CardBuilder struct {
	id         string
	class      string
	attrs      templ.Attributes
	fragmentID string
}

// Card renders a bordered container for grouping related content. Use it for dashboard
// widgets, form sections, or any content that needs visual separation. Compose with
// CardHeader, CardTitle, CardDescription, CardContent, and CardFooter sub-components.
//
//	@components.Card().Render() {
//		@components.CardHeader() {
//			@components.CardTitle("Title")
//			@components.CardDescription("Description")
//		}
//		@components.CardContent() { Body content }
//		@components.CardFooter() { Footer actions }
//	}
func Card() *CardBuilder {
	return &CardBuilder{}
}

func (b *CardBuilder) WithID(id string) *CardBuilder     { b.id = id; return b }
func (b *CardBuilder) WithClass(c string) *CardBuilder   { b.class = cn(b.class, c); return b }
func (b *CardBuilder) SetClass(c string) *CardBuilder    { b.class = c; return b }
func (b *CardBuilder) WithAttr(key string, val any) *CardBuilder {
	if b.attrs == nil { b.attrs = templ.Attributes{} }
	b.attrs[key] = val; return b
}
func (b *CardBuilder) WithFragment(id string) *CardBuilder { b.fragmentID = id; return b }

// --- Class helpers ---

func cardClasses(b *CardBuilder) string {
	return cn("rounded-box border border-base-300 bg-base-100 shadow-sm", b.class)
}

func cardHeaderClasses(class string) string {
	return cn("flex flex-col space-y-1.5 p-6", class)
}

func cardTitleClasses(class string) string {
	return cn("text-lg font-semibold leading-none tracking-tight text-base-content", class)
}

func cardDescriptionClasses(class string) string {
	return cn("text-sm text-base-content/60", class)
}

func cardContentClasses(class string) string {
	return cn("p-6 pt-0", class)
}

func cardFooterClasses(class string) string {
	return cn("flex items-center p-6 pt-0", class)
}

// --- Templ ---

templ (b *CardBuilder) Render() {
	if b.fragmentID != "" {
		@templ.Fragment(b.fragmentID) {
			@b.render()
		}
	} else {
		@b.render()
	}
}

templ (b *CardBuilder) render() {
	<div
		class={ cardClasses(b) }
		if b.id != "" {
			id={ b.id }
		}
		if b.attrs != nil {
			{ b.attrs... }
		}
	>
		{ children... }
	</div>
}

templ CardHeader(opts ...Opt) {
	<div class={ cardHeaderClasses(classFrom(opts)) } if attrsFrom(opts) != nil { { attrsFrom(opts)... } }>
		{ children... }
	</div>
}

templ CardTitle(title string, opts ...Opt) {
	<h3 class={ cardTitleClasses(classFrom(opts)) } if attrsFrom(opts) != nil { { attrsFrom(opts)... } }>
		{ title }
	</h3>
}

templ CardDescription(description string, opts ...Opt) {
	<p class={ cardDescriptionClasses(classFrom(opts)) } if attrsFrom(opts) != nil { { attrsFrom(opts)... } }>
		{ description }
	</p>
}

templ CardContent(opts ...Opt) {
	<div class={ cardContentClasses(classFrom(opts)) } if attrsFrom(opts) != nil { { attrsFrom(opts)... } }>
		{ children... }
	</div>
}

templ CardFooter(opts ...Opt) {
	<div class={ cardFooterClasses(classFrom(opts)) } if attrsFrom(opts) != nil { { attrsFrom(opts)... } }>
		{ children... }
	</div>
}
