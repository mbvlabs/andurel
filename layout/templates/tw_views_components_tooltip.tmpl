package components

// --- Types ---

type TooltipSide string

const (
	TooltipSideTop    TooltipSide = "top"
	TooltipSideRight  TooltipSide = "right"
	TooltipSideBottom TooltipSide = "bottom"
	TooltipSideLeft   TooltipSide = "left"
)

// --- Builder ---

type TooltipBuilder struct {
	id         string
	class      string
	attrs      templ.Attributes
	fragmentID string
}

// Tooltip shows a small informational popup on hover. Use it to provide brief explanations
// for icon buttons, truncated text, or any element that needs additional context. Compose
// with TooltipTrigger and TooltipContent sub-components.
//
//	@components.Tooltip().Render() {
//		@components.TooltipTrigger() {
//			@components.Button(components.ButtonProps{Label: "Hover me"}).WithVariant(components.ButtonVariantOutline).Render()
//		}
//		@components.TooltipContent() { Helpful tip }
//	}
func Tooltip() *TooltipBuilder {
	return &TooltipBuilder{}
}

func (b *TooltipBuilder) WithID(id string) *TooltipBuilder     { b.id = id; return b }
func (b *TooltipBuilder) WithClass(c string) *TooltipBuilder   { b.class = cn(b.class, c); return b }
func (b *TooltipBuilder) SetClass(c string) *TooltipBuilder    { b.class = c; return b }
func (b *TooltipBuilder) WithAttr(key string, val any) *TooltipBuilder {
	if b.attrs == nil { b.attrs = templ.Attributes{} }
	b.attrs[key] = val; return b
}
func (b *TooltipBuilder) WithFragment(id string) *TooltipBuilder { b.fragmentID = id; return b }

// --- Class helpers ---

func tooltipClasses(b *TooltipBuilder) string {
	return cn("relative inline-block group", b.class)
}

func tooltipContentClasses(class string) string {
	base := "z-50 overflow-hidden rounded-field border border-base-300 bg-base-100 px-3 py-1.5 text-xs text-base-content shadow-md"
	return cn(base, class)
}

// --- Templ ---

templ (b *TooltipBuilder) Render() {
	if b.fragmentID != "" {
		@templ.Fragment(b.fragmentID) {
			@b.render()
		}
	} else {
		@b.render()
	}
}

templ (b *TooltipBuilder) render() {
	<div
		class={ tooltipClasses(b) }
		if b.id != "" {
			id={ b.id }
		}
		if b.attrs != nil {
			{ b.attrs... }
		}
	>
		{ children... }
	</div>
}

templ TooltipTrigger(opts ...Opt) {
	<div class={ cn("cursor-pointer", classFrom(opts)) } if attrsFrom(opts) != nil { { attrsFrom(opts)... } }>
		{ children... }
	</div>
}

templ TooltipContent(opts ...Opt) {
	<div role="tooltip" class={ tooltipContentClasses(classFrom(opts)) } if attrsFrom(opts) != nil { { attrsFrom(opts)... } }>
		{ children... }
	</div>
}
