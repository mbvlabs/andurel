package components

// --- Builder ---

type AccordionBuilder struct {
	id         string
	class      string
	attrs      templ.Attributes
	fragmentID string
}

// Accordion creates an expandable/collapsible content container. Use it to organize
// long content into vertically stacked sections that users can expand one at a time.
// Compose with AccordionItem, AccordionTrigger, and AccordionContent sub-components.
//
//	@components.Accordion().Render() {
//		@components.AccordionItem("", nil) {
//			@components.AccordionTrigger("", nil) { Section Title }
//			@components.AccordionContent("", nil) { Hidden content here }
//		}
//	}
func Accordion() *AccordionBuilder {
	return &AccordionBuilder{}
}

func (b *AccordionBuilder) WithID(id string) *AccordionBuilder     { b.id = id; return b }
func (b *AccordionBuilder) WithClass(c string) *AccordionBuilder   { b.class = cn(b.class, c); return b }
func (b *AccordionBuilder) SetClass(c string) *AccordionBuilder    { b.class = c; return b }
func (b *AccordionBuilder) WithAttr(key string, val any) *AccordionBuilder {
	if b.attrs == nil { b.attrs = templ.Attributes{} }
	b.attrs[key] = val; return b
}
func (b *AccordionBuilder) WithFragment(id string) *AccordionBuilder { b.fragmentID = id; return b }

// --- Class helpers ---

func accordionClasses(b *AccordionBuilder) string {
	return cn("w-full", b.class)
}

func accordionItemClasses(class string) string {
	return cn("border-b border-base-300", class)
}

func accordionTriggerClasses(class string) string {
	return cn("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline cursor-pointer [&[aria-expanded=true]>svg]:rotate-180", class)
}

func accordionContentClasses(class string) string {
	return cn("overflow-hidden text-sm", class)
}

// --- Templ ---

templ (b *AccordionBuilder) Render() {
	if b.fragmentID != "" {
		@templ.Fragment(b.fragmentID) {
			@b.render()
		}
	} else {
		@b.render()
	}
}

templ (b *AccordionBuilder) render() {
	<div
		class={ accordionClasses(b) }
		if b.id != "" {
			id={ b.id }
		}
		if b.attrs != nil {
			{ b.attrs... }
		}
	>
		{ children... }
	</div>
}

templ AccordionItem(class string, attrs templ.Attributes) {
	<div class={ accordionItemClasses(class) } if attrs != nil { { attrs... } }>
		{ children... }
	</div>
}

templ AccordionTrigger(class string, attrs templ.Attributes) {
	<button type="button" class={ accordionTriggerClasses(class) } if attrs != nil { { attrs... } }>
		{ children... }
		<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="shrink-0 transition-transform duration-200"><path d="m6 9 6 6 6-6"></path></svg>
	</button>
}

templ AccordionContent(class string, attrs templ.Attributes) {
	<div class={ accordionContentClasses(class) } if attrs != nil { { attrs... } }>
		<div class="pb-4 pt-0">
			{ children... }
		</div>
	</div>
}
