package components

// --- Builder ---

type PaginationBuilder struct {
	id         string
	class      string
	attrs      templ.Attributes
	fragmentID string
}

// Pagination renders page navigation controls with numbered links, previous/next buttons,
// and ellipsis indicators. Use it for paginated lists, tables, or search results. Compose
// with PaginationPrevious, PaginationItem, PaginationEllipsis, and PaginationNext sub-components.
//
//	@components.Pagination().Render() {
//		@components.PaginationPrevious("/page/1", false, "", nil)
//		@components.PaginationItem("/page/1", false, false, "", nil) { 1 }
//		@components.PaginationItem("/page/2", true, false, "", nil) { 2 }
//		@components.PaginationEllipsis()
//		@components.PaginationNext("/page/3", false, "", nil)
//	}
func Pagination() *PaginationBuilder {
	return &PaginationBuilder{}
}

func (b *PaginationBuilder) WithID(id string) *PaginationBuilder     { b.id = id; return b }
func (b *PaginationBuilder) WithClass(c string) *PaginationBuilder   { b.class = cn(b.class, c); return b }
func (b *PaginationBuilder) SetClass(c string) *PaginationBuilder    { b.class = c; return b }
func (b *PaginationBuilder) WithAttr(key string, val any) *PaginationBuilder {
	if b.attrs == nil { b.attrs = templ.Attributes{} }
	b.attrs[key] = val; return b
}
func (b *PaginationBuilder) WithFragment(id string) *PaginationBuilder { b.fragmentID = id; return b }

// --- Class helpers ---

func paginationClasses(b *PaginationBuilder) string {
	return cn("mx-auto flex w-full justify-center", b.class)
}

func paginationItemClasses(active bool, disabled bool, class string) string {
	base := "inline-flex items-center justify-center whitespace-nowrap rounded-field text-sm font-medium transition-colors h-9 w-9"
	if active {
		return cn(base, "bg-primary text-primary-content", class)
	}
	if disabled {
		return cn(base, "opacity-60 cursor-not-allowed", class)
	}
	return cn(base, "hover:bg-base-200 text-base-content", class)
}

// --- Templ ---

templ (b *PaginationBuilder) Render() {
	if b.fragmentID != "" {
		@templ.Fragment(b.fragmentID) {
			@b.render()
		}
	} else {
		@b.render()
	}
}

templ (b *PaginationBuilder) render() {
	<nav
		aria-label="pagination"
		class={ paginationClasses(b) }
		if b.id != "" {
			id={ b.id }
		}
		if b.attrs != nil {
			{ b.attrs... }
		}
	>
		<ul class="flex flex-row items-center gap-1">
			{ children... }
		</ul>
	</nav>
}

templ PaginationItem(href string, active bool, disabled bool, class string, attrs templ.Attributes) {
	<li>
		if disabled {
			<span class={ paginationItemClasses(active, disabled, class) } if attrs != nil { { attrs... } }>
				{ children... }
			</span>
		} else {
			<a href={ templ.SafeURL(href) } class={ paginationItemClasses(active, disabled, class) } if attrs != nil { { attrs... } }>
				{ children... }
			</a>
		}
	</li>
}

templ PaginationPrevious(href string, disabled bool, class string, attrs templ.Attributes) {
	<li>
		if disabled {
			<span class={ paginationItemClasses(false, disabled, cn("gap-1 pl-2.5 w-auto px-3", class)) } if attrs != nil { { attrs... } }>
				<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg>
				Previous
			</span>
		} else {
			<a href={ templ.SafeURL(href) } class={ paginationItemClasses(false, disabled, cn("gap-1 pl-2.5 w-auto px-3", class)) } if attrs != nil { { attrs... } }>
				<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg>
				Previous
			</a>
		}
	</li>
}

templ PaginationNext(href string, disabled bool, class string, attrs templ.Attributes) {
	<li>
		if disabled {
			<span class={ paginationItemClasses(false, disabled, cn("gap-1 pr-2.5 w-auto px-3", class)) } if attrs != nil { { attrs... } }>
				Next
				<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"></path></svg>
			</span>
		} else {
			<a href={ templ.SafeURL(href) } class={ paginationItemClasses(false, disabled, cn("gap-1 pr-2.5 w-auto px-3", class)) } if attrs != nil { { attrs... } }>
				Next
				<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"></path></svg>
			</a>
		}
	</li>
}

templ PaginationEllipsis() {
	<li>
		<span class="flex h-9 w-9 items-center justify-center text-base-content/60">
			<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle></svg>
		</span>
	</li>
}
