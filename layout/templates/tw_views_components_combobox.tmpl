package components

// --- Types ---

type ComboboxProps struct {
	ID          string
	Class       string
	Attributes  templ.Attributes
	Name        string
	Placeholder string
}

type ComboboxItemProps struct {
	Class      string
	Attributes templ.Attributes
	Value      string
	Selected   bool
}

// --- Class helpers ---

func comboboxClasses(p ComboboxProps) string {
	return cn("relative w-full", p.Class)
}

func comboboxInputClasses() string {
	return "flex h-9 w-full rounded-field border border-base-300 bg-base-200 px-3 py-1 pr-8 text-sm text-base-content shadow-inner transition placeholder:text-base-content/40 focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/50"
}

func comboboxListClasses() string {
	return "absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded-box border border-base-300 bg-base-100 p-1 shadow-md"
}

func comboboxItemClasses(p ComboboxItemProps) string {
	base := "relative flex cursor-pointer select-none items-center rounded-field px-2 py-1.5 text-sm outline-none hover:bg-base-200"
	if p.Selected {
		return cn(base, "bg-base-200", p.Class)
	}
	return cn(base, p.Class)
}

// --- Templ ---

templ Combobox(props ...ComboboxProps) {
	{{ "{{" }} var p ComboboxProps {{ "}}" }}
	if len(props) > 0 {
		{{ "{{" }} p = props[0] {{ "}}" }}
	}
	<div class={ comboboxClasses(p) } { p.Attributes... }>
		<div class="relative">
			<input
				type="text"
				class={ comboboxInputClasses() }
				if p.ID != "" {
					id={ p.ID }
				}
				if p.Placeholder != "" {
					placeholder={ p.Placeholder }
				}
				if p.Name != "" {
					data-bind={ p.Name }
					data-attr:disabled="$submitting"
				}
				autocomplete="off"
			/>
			<div class="absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
				<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-base-content/40"><path d="m7 15 5 5 5-5"></path><path d="m7 9 5-5 5 5"></path></svg>
			</div>
		</div>
		{ children... }
	</div>
}

templ ComboboxList() {
	<ul class={ comboboxListClasses() } role="listbox">
		{ children... }
	</ul>
}

templ ComboboxItem(props ...ComboboxItemProps) {
	{{ "{{" }} var p ComboboxItemProps {{ "}}" }}
	if len(props) > 0 {
		{{ "{{" }} p = props[0] {{ "}}" }}
	}
	<li
		class={ comboboxItemClasses(p) }
		role="option"
		if p.Value != "" {
			data-value={ p.Value }
		}
		if p.Selected {
			aria-selected="true"
		}
		{ p.Attributes... }
	>
		if p.Selected {
			<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 shrink-0"><path d="M20 6 9 17l-5-5"></path></svg>
		}
		{ children... }
	</li>
}
