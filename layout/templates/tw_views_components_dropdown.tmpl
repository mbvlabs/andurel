package components

// --- Builder ---

type DropdownBuilder struct {
	id         string
	class      string
	attrs      templ.Attributes
	fragmentID string
}

// Dropdown creates a menu that appears when a trigger element is activated. Use it for
// action menus, context menus, or navigation sub-menus. Compose with DropdownTrigger,
// DropdownContent, DropdownItem, DropdownLabel, and DropdownSeparator sub-components.
//
//	@components.Dropdown().Render() {
//		@components.DropdownTrigger("", nil) {
//			@components.Button().Render() { Open Menu }
//		}
//		@components.DropdownContent("", nil) {
//			@components.DropdownLabel("", nil) { Actions }
//			@components.DropdownSeparator()
//			@components.DropdownItem(false, "", nil) { Edit }
//			@components.DropdownItem(false, "", nil) { Delete }
//		}
//	}
func Dropdown() *DropdownBuilder {
	return &DropdownBuilder{}
}

func (b *DropdownBuilder) WithID(id string) *DropdownBuilder     { b.id = id; return b }
func (b *DropdownBuilder) WithClass(c string) *DropdownBuilder   { b.class = cn(b.class, c); return b }
func (b *DropdownBuilder) SetClass(c string) *DropdownBuilder    { b.class = c; return b }
func (b *DropdownBuilder) WithAttr(key string, val any) *DropdownBuilder {
	if b.attrs == nil { b.attrs = templ.Attributes{} }
	b.attrs[key] = val; return b
}
func (b *DropdownBuilder) WithFragment(id string) *DropdownBuilder { b.fragmentID = id; return b }

// --- Class helpers ---

func dropdownClasses(b *DropdownBuilder) string {
	return cn("relative inline-block text-left", b.class)
}

func dropdownContentClasses(class string) string {
	base := "z-50 min-w-[8rem] overflow-hidden rounded-box border border-base-300 bg-base-100 p-1 text-base-content shadow-md"
	return cn(base, class)
}

func dropdownItemClasses(disabled bool, class string) string {
	base := "relative flex cursor-pointer select-none items-center rounded-field px-2 py-1.5 text-sm outline-none transition-colors hover:bg-base-200 focus:bg-base-200"
	if disabled {
		return cn(base, "opacity-60 cursor-not-allowed", class)
	}
	return cn(base, class)
}

func dropdownLabelClasses(class string) string {
	return cn("px-2 py-1.5 text-sm font-semibold text-base-content", class)
}

// --- Templ ---

templ (b *DropdownBuilder) Render() {
	if b.fragmentID != "" {
		@templ.Fragment(b.fragmentID) {
			@b.render()
		}
	} else {
		@b.render()
	}
}

templ (b *DropdownBuilder) render() {
	<div
		class={ dropdownClasses(b) }
		if b.id != "" {
			id={ b.id }
		}
		if b.attrs != nil {
			{ b.attrs... }
		}
	>
		{ children... }
	</div>
}

templ DropdownTrigger(class string, attrs templ.Attributes) {
	<div class={ cn("cursor-pointer", class) } if attrs != nil { { attrs... } }>
		{ children... }
	</div>
}

templ DropdownContent(class string, attrs templ.Attributes) {
	<div class={ dropdownContentClasses(class) } role="menu" if attrs != nil { { attrs... } }>
		{ children... }
	</div>
}

templ DropdownItem(disabled bool, class string, attrs templ.Attributes) {
	<div class={ dropdownItemClasses(disabled, class) } role="menuitem" if attrs != nil { { attrs... } }>
		{ children... }
	</div>
}

templ DropdownSeparator() {
	<div class="-mx-1 my-1 h-px bg-base-300"></div>
}

templ DropdownLabel(class string, attrs templ.Attributes) {
	<div class={ dropdownLabelClasses(class) } if attrs != nil { { attrs... } }>
		{ children... }
	</div>
}
