package components

// --- Builder ---

type TabsBuilder struct {
	id         string
	class      string
	attrs      templ.Attributes
	fragmentID string
}

// Tabs organizes content into switchable panels. Use it when content can be logically
// grouped into parallel views (e.g., Account/Settings, Code/Preview). Compose with
// TabsList, TabsTrigger, and TabsContent sub-components.
//
//	@components.Tabs().Render() {
//		@components.TabsList() {
//			@components.TabsTrigger("Tab 1", true)
//			@components.TabsTrigger("Tab 2", false)
//		}
//		@components.TabsContent() { Content for tab 1 }
//	}
func Tabs() *TabsBuilder {
	return &TabsBuilder{}
}

func (b *TabsBuilder) WithID(id string) *TabsBuilder     { b.id = id; return b }
func (b *TabsBuilder) WithClass(c string) *TabsBuilder   { b.class = cn(b.class, c); return b }
func (b *TabsBuilder) SetClass(c string) *TabsBuilder    { b.class = c; return b }
func (b *TabsBuilder) WithAttr(key string, val any) *TabsBuilder {
	if b.attrs == nil { b.attrs = templ.Attributes{} }
	b.attrs[key] = val; return b
}
func (b *TabsBuilder) WithFragment(id string) *TabsBuilder { b.fragmentID = id; return b }

// --- Class helpers ---

func tabsClasses(b *TabsBuilder) string {
	return cn("w-full", b.class)
}

func tabsListClasses(class string) string {
	return cn("inline-flex h-9 items-center justify-center rounded-box bg-base-200 p-1 text-base-content/60", class)
}

func tabsTriggerClasses(active bool, class string) string {
	base := "inline-flex items-center justify-center whitespace-nowrap rounded-field px-3 py-1 text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/50 disabled:pointer-events-none disabled:opacity-60"
	if active {
		return cn(base, "bg-base-100 text-base-content shadow-sm", class)
	}
	return cn(base, "hover:text-base-content", class)
}

func tabsContentClasses(class string) string {
	return cn("mt-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/50", class)
}

// --- Templ ---

templ (b *TabsBuilder) Render() {
	if b.fragmentID != "" {
		@templ.Fragment(b.fragmentID) {
			@b.render()
		}
	} else {
		@b.render()
	}
}

templ (b *TabsBuilder) render() {
	<div
		class={ tabsClasses(b) }
		if b.id != "" {
			id={ b.id }
		}
		if b.attrs != nil {
			{ b.attrs... }
		}
	>
		{ children... }
	</div>
}

templ TabsList(opts ...Opt) {
	<div role="tablist" class={ tabsListClasses(classFrom(opts)) } if attrsFrom(opts) != nil { { attrsFrom(opts)... } }>
		{ children... }
	</div>
}

templ TabsTrigger(label string, active bool, opts ...Opt) {
	<button type="button" role="tab" class={ tabsTriggerClasses(active, classFrom(opts)) } if attrsFrom(opts) != nil { { attrsFrom(opts)... } }>
		{ label }
	</button>
}

templ TabsContent(opts ...Opt) {
	<div role="tabpanel" class={ tabsContentClasses(classFrom(opts)) } if attrsFrom(opts) != nil { { attrsFrom(opts)... } }>
		{ children... }
	</div>
}
